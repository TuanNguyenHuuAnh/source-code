<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{templates/unit-layout}"
  layout:fragment="body"
>
  <script
    type="text/javascript"
    th:src="@{/static/jquery/multiple-select/js/jquery.multiselect.js}"
  ></script>
  <link
    rel="stylesheet"
    type="text/css"
    th:href="@{/static/jquery/multiple-select/css/jquery.multiselect.css}"
  />
  <script
    type="text/javascript"
    th:src="@{/static/js/plupload-2.1.2/plupload.full.min.js}"
  ></script>
  <script>
    $(document).ready(function ($) {
      $("#btnAdd").on("click", function (event) {
        showModal();
      });
    });

    function showModal() {
      $("#myModal").modal("show");
      $("#myModal").css("z-index", 5000);
    }

    /* Tranlth 27/05/2019 Thêm mới Task #23724*/
    function checkStatus(event) {
      if (event.checked) {
        $(".chkStatus").prop("checked", true);
      } else {
        $(".chkStatus").prop("checked", false);
      }
    }
    /* End*/
  </script>
  <script th:inline="javascript">
    /*<![CDATA[*/
    	var msgAssetAdd = 'Please select Source Owner' ;
    	var msgAssetDetail 		= /*[[#{asset-transfer.error.list-detail.required}]]*/ ;
    /*]]>*/
  </script>

  <!-- header page start -->
  <div class="title-head clearfix">
    <div class="col-sm-9 col-xs-7 no-padding">
      <h3><i class="fa fa-table"></i>Asset Return</h3>
    </div>
    <div class="col-sm-3 col-xs-5 icon-head">
      <div class="pull-right">
        <a>
          <i
            class="fa fa-arrow-circle-left icon-head-red"
            th:title="#{back.button}"
            id="linkList"
          ></i>
        </a>
        <!-- <a th:if="${#authorization.expression('hasAuthority(@roleEp2p.ROLE_ASSET_MANAGEMENT_SUBMIT)')}"> <i class="fa fa-plus-circle icon-head-red" id="add"></i>
			</a> -->
      </div>
    </div>
  </div>

  <form
    class="form-horizontal u-for-page-top j-form-validate"
    id="form-assetreturn-edit"
    th:action="@{/asset-return/edit}"
    th:object="${assetReturnDto}"
    method="post"
    role="form"
  >
    <div id="message-list"></div>
    <th:block
      th:include="/views/ASSET_MANAGEMENT_MODULE/commons/message-alert.html :: content(${messageList})"
    />

    <input type="hidden" th:field="*{assetReturnId}" />
    <!-- DETAIL -->
    <!-- process Title, Code, Name, Description start -->
    <div class="bg-content clearfix bg-content-tbl">
      <div data-toggle="collapse" data-target="#edit-box" class="header-box">
        <h2 class="title-box">Return Information</h2>
        <i class="fa fa-minus pull-right" aria-hidden="true"></i>
      </div>
      <div class="collapse in row m-0" id="edit-box">
        <div class="col-sm-12 p-0">
          <div class="form-group">
            <label class="col-sm-2 required">Return No</label>
            <div class="col-sm-4">
              <input
                type="hidden"
                class="form-control"
                id="enableHiddenBeforeSend"
              />
              <input
                type="text"
                class="form-control"
                th:field="*{returnNo}"
                readonly="readonly"
              />
            </div>

            <div class="form-group">
              <label class="col-sm-2"
                >Return Date <span style="color: red">*</span></label
              >
              <div class="col-sm-4">
                <div class="input-group datepicker">
                  <input
                    class="form-control required"
                    type="text"
                    placeholder="dd/mm/yyyy"
                    autocomplete="off"
                    readonly="readonly"
                    name="returnDate"
                    th:value="${assetReturnDto.returnDate} ? ${#dates.format(assetReturnDto.returnDate, @menuConfig.getFormDate())}"
                  />
                  <!-- 							<input class="form-control" type="hidden" -->
                  <!-- 								th:field="*{returnDate}" /> -->
                  <div class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2"
              >Return By <span style="color: red">*</span></label
            >
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control required"
                readonly="readonly"
                th:field="*{returnFullname}"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{returnUsername}"
                th:value="${assetReturnDto.returnUsername}"
              />
            </div>

            <label class="col-sm-2"
              >Return Dept. <span style="color: red">*</span></label
            >
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control"
                readonly="readonly"
                th:field="*{returnDeptFullOption}"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{returnDept}"
              />
              <input
                type="hidden"
                class="form-control"
                readonly="readonly"
                th:field="*{propertyOf}"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2"
              >Owner<span style="color: red"> *</span></label
            >
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control required"
                maxlength="255"
                th:field="*{assetOwnerFullname}"
                th:disabled="${!assetReturnDto.hasEdit}"
              />
              <input
                type="hidden"
                class="form-control required"
                maxlength="255"
                th:field="*{assetOwnerFullname}"
                th:disabled="${assetReturnDto.hasEdit}"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{assetOwnerUsername}"
              />
            </div>

            <label class="col-sm-2">Owner Dept.</label>
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control"
                th:field="*{assetOwnerDeptFullOption}"
                th:readonly="${!assetReturnDto.hasEdit}"
                maxlength="255"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{assetOwnerDept}"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2"
              >Location <span style="color: red">*</span></label
            >
            <div class="col-sm-4">
              <select
                class="form-control j-required"
                th:field="*{location}"
                th:disabled="${!assetReturnDto.hasEdit}"
              ></select>
              <input
                type="hidden"
                th:field="*{location}"
                th:disabled="${assetReturnDto.hasEdit}"
              />
              <label style="display: none" class="error" for="location"></label>
            </div>

            <label class="col-sm-2"
              >Warehouse <span style="color: red">*</span></label
            >
            <div class="col-sm-4">
              <!-- <span
						th:if="${#authorization.expression('hasAuthority(@roleEp2p.ROLE_ASSET_MANAGEMENT_VERIFY)')} or ${assetReturnDto.stepNo != 0 and assetReturnDto.stepNo != 98}">
						<input type="text" class="form-control required" th:field="*{location}"
						readonly="readonly"/>
						<input type="hidden" class="form-control" th:field="*{locationCode}"/>
					</span> <span
						th:unless="${#authorization.expression('hasAuthority(@roleEp2p.ROLE_ASSET_MANAGEMENT_VERIFY)')} or ${assetReturnDto.stepNo != 0 and assetReturnDto.stepNo != 98}">
						<input type="text" class="form-control required" th:field="*{location}" readonly="readonly"/>
						<input type="hidden" class="form-control" th:field="*{locationCode}"/>
					</span> -->
              <select
                class="form-control j-required"
                th:field="*{warehouse}"
                th:disabled="${!assetReturnDto.hasEdit}"
              >
                <option value="">--</option>
              </select>
              <input
                type="hidden"
                th:field="*{warehouse}"
                th:disabled="${assetReturnDto.hasEdit}"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{warehouseCode}"
              />
              <input
                type="hidden"
                class="form-control"
                th:field="*{warehouseName}"
              />
              <label style="display: none" class="error" for="warehouse"
                >Field is required</label
              >
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2 required">Reason for Return</label>
            <div class="col-sm-10">
              <textarea
                type="text"
                class="form-control required"
                th:field="*{reasonForReturn}"
                th:readonly="${!assetReturnDto.hasEdit}"
              >
              </textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-content clearfix bg-content-tbl">
      <div data-toggle="collapse" data-target="#edit-box1" class="header-box">
        <h2 class="title-box">Asset Detail Information</h2>
        <i class="fa fa-minus pull-right" aria-hidden="true"></i>
      </div>
      <div class="collapse in row m-0" id="edit-box1">
        <div class="col-md-12 p-0">
          <div class="pull-right">
            <a
              class="btn-common hide"
              id="btnAdd"
              th:if="${assetReturnDto.hasEdit}"
            >
              <i class="fa fa-plus" aria-hidden="true"></i> <span>Add</span>
            </a>
            <a
              class="btn-common"
              id="btnAddHiden"
              th:if="${assetReturnDto.hasEdit}"
            >
              <i class="fa fa-plus" aria-hidden="true"></i> <span>Add</span>
            </a>
          </div>
        </div>
        <div class="col-sm-12 p-0">
          <div class="table-responsive col-sm-12 no-padding">
            <table
              id="tblDataTable1"
              class="table table-bordered table-striped"
            >
              <thead>
                <tr>
                  <th style="min-width: 50px">Action</th>
                  <th style="min-width: 120px">Asset Type</th>
                  <th style="min-width: 155px">Name of the Asset</th>
                  <th style="min-width: 50px">Asset Sub Category</th>
                  <th style="min-width: 50px">Asset Status</th>
                  <th style="min-width: 180px">Serial No</th>
                  <th style="min-width: 100px">Asset Tag No</th>
                  <th style="min-width: 120px">Quantity</th>
                  <th style="min-width: 120px">Unit of Measure</th>
                  <th style="min-width: 120px">Register Date</th>
                </tr>
              </thead>
              <tbody id="body">
                <th:block th:each="item,i : ${assetReturnDto.lstPrApproved}">
                  <tr
                    class="row_pr align-top rownum"
                    th:attr="id=${'pr_' + item.id},data-index=${i.index},data-process=${assetReturnDto.processStatusCode}"
                  >
                    <td class="td-action">
                      <span
                        th:if="${#authorization.expression('hasAuthority(@roleEp2p.ROLE_ASSET_MANAGEMENT_VERIFY)')} or ${assetReturnDto.stepNo != 0 and assetReturnDto.stepNo != 98}"
                      >
                        <a
                          th:attr="onclick='deletePr(' + ${item.id} + ')'"
                          class="
                            glyphicon glyphicon-remove-sign
                            font-size-20
                            red
                            j-btn-delete
                          "
                          title="Delete"
                        ></a>
                      </span>
                      <span
                        th:unless="${#authorization.expression('hasAuthority(@roleEp2p.ROLE_ASSET_MANAGEMENT_VERIFY)')} or ${assetReturnDto.stepNo != 0 and assetReturnDto.stepNo != 98}"
                      >
                        <a
                          th:attr="onclick='deletePr(' + ${item.id} + ')'"
                          class="
                            glyphicon glyphicon-remove-sign
                            font-size-20
                            red
                          "
                          title="Delete"
                        ></a>
                      </span>
                    </td>

                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].id'"
                      th:value="${item.id}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetProfileId'"
                      th:value="${item.assetProfileId}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].returnId'"
                      th:value="${item.returnId}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].returnNo'"
                      th:value="${item.returnNo}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetOwnerUsername'"
                      th:value="${item.assetOwnerUsername}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetOwnerFullname'"
                      th:value="${item.assetOwnerFullname}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetOwnerDept'"
                      th:value="${item.assetOwnerDept}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetTypeName'"
                      th:value="${item.assetTypeName}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetTypeCode'"
                      th:value="${item.assetTypeCode}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetName'"
                      th:value="${item.assetName}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetDescription'"
                      th:value="${item.assetDescription}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetCategoryName'"
                      th:value="${item.assetCategoryName}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetCategoryCode'"
                      th:value="${item.assetCategoryCode}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetSubCategoryName'"
                      th:value="${item.assetSubCategoryName}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetSubCategoryCode'"
                      th:value="${item.assetSubCategoryCode}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetTag'"
                      th:value="${item.assetTag}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].propertyOf'"
                      th:value="${item.propertyOf}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].serialNo'"
                      th:value="${item.serialNo}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].quantity'"
                      th:value="${item.quantity}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].uomCode'"
                      th:value="${item.uomCode}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].uomName'"
                      th:value="${item.uomName}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].companyCode'"
                      th:value="${item.companyCode}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetRegisterDate'"
                      th:value="${item.assetRegisterDate} ? ${#dates.format(item.assetRegisterDate, @menuConfig.getFormDate())}"
                    />
                    <input
                      type="hidden"
                      th:name="'lstPrApproved[' + ${i.index} +'].assetStatus'"
                      th:value="${item.assetStatus}"
                    />

                    <td th:inline="text" class="text-left">
                      [[${item.assetTypeName}]]<br />
                      <small
                        th:if="${item.error}"
                        th:text="'This asset is not available. Please choose another one'"
                        style="color: red"
                      ></small>
                    </td>
                    <td class="text-left" th:text="${item.assetName}"></td>
                    <td
                      class="text-left"
                      th:text="${item.assetSubCategoryName}"
                    ></td>
                    <span th:if="${item.assetStatus == '0'}"
                      ><td class="text-left">New</td></span
                    >
                    <span th:if="${item.assetStatus == '1'}"
                      ><td class="text-left">In-Use</td></span
                    >
                    <span th:if="${item.assetStatus == '2'}"
                      ><td class="text-left">Re-Use</td></span
                    >
                    <span th:if="${item.assetStatus == '5'}"
                      ><td class="text-left">Broken</td></span
                    >
                    <span th:if="${item.assetStatus == '6'}"
                      ><td class="text-left">Repairing</td></span
                    >
                    <span th:if="${item.assetStatus == '7'}"
                      ><td class="text-left">Obsolete</td></span
                    >
                    <td class="text-left" th:text="${item.serialNo}"></td>
                    <td class="text-left" th:text="${item.assetTag}"></td>
                    <td class="text-center" th:text="${item.quantity}"></td>
                    <td class="text-left" th:text="${item.uomName}"></td>
                    <td
                      class="text-center"
                      th:text="${item.assetRegisterDate} ? ${#dates.format(item.assetRegisterDate, @menuConfig.getFormDate())}"
                    ></td>
                  </tr>
                </th:block>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <input type="hidden" th:value="${refAttachment}" th:name="refAttachment" />
    <input type="hidden" th:field="*{processId}" id="processId" />
    <input
      type="hidden"
      th:value="${assetReturnDto.assetReturnId}"
      id="abtract-reference-id"
    />
    <input type="hidden" th:field="*{createdBy}" />
    <input type="hidden" th:field="*{stepNo}" />
    <input type="hidden" th:field="*{processStatusCode}" />
    <input type="hidden" th:field="*{comments}" id="commentsId" />
    <input type="hidden" th:field="*{owner}" id="ownerId" />
    <input type="hidden" th:field="*{assignee}" id="assigneeId" />
    <input
      type="hidden"
      th:field="*{businessCode}"
      id="abtract-business-code"
    />
    <input type="hidden" th:field="*{stepId}" id="abtract-step-id" />
  </form>
  <!-- AttachedFile -->
  <div id="attachedFileContent">
    <th:block
      th:include="/views/ASSET_MANAGEMENT_MODULE/attached-file-module/attached-file-plugin.html :: content(${lstAttachedFile},${businessCode},${refAttachment})"
    />
  </div>

  <!-- process -->
  <th:block
    th:include="/views/ASSET_MANAGEMENT_MODULE/approval-module/approval-plugin.html :: content(${approvalModuleDto},'form-assetreturn-edit','asset-return', ${@roleEp2p.ROLE_ASSET_RETURN},'')"
  />

  <div
    class="modal fade"
    id="myModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="myModalLabel"
  >
    <div
      class="modal-dialog"
      role="document"
      style="width: 80%; max-width: 80%"
    >
      <div class="modal-content">
        <div class="modal-header">
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="myModalLabel">Asset Profile</h4>
        </div>
        <div class="modal-body">
          <div class="col-sm-12 p-0">
            <th:block
              th:include="/views/ASSET_MANAGEMENT_MODULE/assetreturn/assetreturn-model-list.html :: content"
            />
          </div>
        </div>
        <div align="center">
          <!-- vunh 27/05/2019 thêm mới add và bỏ Ok + Cancel Task #23724 -->
          <a
            class="btn-common btn-in-tablet hide"
            data-dismiss="modal"
            type="submit"
            id="btnOK"
          >
            <i class="fa fa-plus" aria-hidden="true"></i>
            <span th:text="#{add.button}">Add</span>
          </a>
          <a class="btn-common btn-in-tablet" id="btnAddHide">
            <i class="fa fa-plus"></i> <span th:text="#{add.button}">Add</span>
          </a>
          <a href="#" class="btn-cancel" data-dismiss="modal"
            ><i class="fa fa-times"></i> Close</a
          >
          <!-- End -->
        </div>
      </div>
    </div>
  </div>
  <script th:inline="javascript">
    /*<![CDATA[*/
    var selectedAccount = /*[[${assetReturnDto.assetOwnerFullname}]]*/;
    var selectedWarehouse = /*[[${assetReturnDto.warehouse}]]*/;
    var selectedLocation = /*[[${assetReturnDto.location}]]*/;
    /*]]>*/
  </script>
  <script
    type="text/javascript"
    th:src="@{/static/ASSET_MANAGEMENT_MODULE/js/assetreturn/assetreturn-edit.js} + ${'?rev=' + @systemConfig.getRev()}"
  ></script>
</html>
